import os
from openpyxl import load_workbook

def get_input_from_excel_sheet(column_name, test_case_name, sheet_name):
    try:
        # Build Excel path
        script_dir = os.path.dirname(os.path.abspath(__file__))
        parent_dir = os.path.dirname(script_dir)
        input_file = os.path.join(parent_dir, "resources", "data_file", "data.xlsx")

        # Load workbook and sheet
        wb = load_workbook(input_file)
        if sheet_name not in wb.sheetnames:
            print(f"Sheet '{sheet_name}' not found.")
            return None
        ws = wb[sheet_name]

        # Find the column index for the column_name in the first row
        col_index = None
        for col in ws.iter_cols(min_row=1, max_row=1):
            if col[0].value == column_name:
                col_index = col[0].column
                break

        if not col_index:
            print(f"Column '{column_name}' not found.")
            return None

        # Find the row that contains the test_case_name in "Test Case Name" column
        tc_col_index = None
        for col in ws.iter_cols(min_row=1, max_row=1):
            if col[0].value == "Test Case Name":
                tc_col_index = col[0].column
                break

        if not tc_col_index:
            print(f"'Test Case Name' column not found.")
            return None

        target_row = None
        for row in ws.iter_rows(min_row=2):
            if str(row[tc_col_index - 1].value).strip() == test_case_name:
                target_row = row
                break

        if not target_row:
            print(f"Test Case '{test_case_name}' not found.")
            return None

        value = ws.cell(row=target_row[0].row, column=col_index).value
        return value

    except Exception as e:
        print(f"An error occurred: {e}")
        return None
